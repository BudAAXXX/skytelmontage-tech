// SkyTel Montage â€“ InteraktivnÃ­ web s reÃ¡lnou fyzikou stoÅ¾Ã¡ru a promÄ›nlivou krajinou
// GitHub-ready, ÄistÃ½ HTML+JS bez build nÃ¡strojÅ¯

import { useEffect, useRef, useState } from "react";
import { motion } from "framer-motion";
import Matter from "matter-js";

export default function SkyTelMontage() {
  const sceneRef = useRef(null);
  const [engine, setEngine] = useState(null);
  const [world, setWorld] = useState(null);
  const [pieces, setPieces] = useState([]);
  const [fallen, setFallen] = useState(false);

  useEffect(() => {
    const Engine = Matter.Engine,
      Render = Matter.Render,
      World = Matter.World,
      Bodies = Matter.Bodies,
      Runner = Matter.Runner,
      Body = Matter.Body,
      Events = Matter.Events;

    const engine = Engine.create();
    const world = engine.world;
    setEngine(engine);
    setWorld(world);

    const render = Render.create({
      element: sceneRef.current,
      engine: engine,
      options: {
        width: window.innerWidth,
        height: window.innerHeight,
        wireframes: false,
        background: "transparent",
      },
    });

    Render.run(render);
    const runner = Runner.create();
    Runner.run(runner, engine);

    const ground = Bodies.rectangle(
      window.innerWidth / 2,
      window.innerHeight - 50,
      window.innerWidth,
      60,
      { isStatic: true, render: { fillStyle: "#333" } }
    );

    World.add(world, [ground]);

    // VytvoÅ™enÃ­ stoÅ¾Ã¡ru z kusÅ¯
    const partCount = 10;
    const partHeight = 30;
    const partWidth = 20;
    const parts = Array.from({ length: partCount }).map((_, i) =>
      Bodies.rectangle(
        window.innerWidth / 2,
        window.innerHeight - 60 - i * partHeight,
        partWidth,
        partHeight,
        {
          isStatic: true,
          render: { fillStyle: "#777" },
          label: `part_${i}`,
        }
      )
    );

    setPieces(parts);
    World.add(world, parts);

    return () => {
      Render.stop(render);
      World.clear(world);
      Engine.clear(engine);
      render.canvas.remove();
      render.textures = {};
    };
  }, []);

  const dropPiece = () => {
    if (!engine || !pieces.length) return;
    const next = pieces[0];
    Matter.Body.setStatic(next, false);
    setPieces((prev) => prev.slice(1));
    if (pieces.length === 1) setFallen(true);
  };

  return (
    <div className="relative h-screen w-screen bg-gradient-to-b from-blue-300 to-green-500 overflow-hidden">
      {/* Obloha a nÃ¡pis */}
      <div className="absolute top-4 left-1/2 transform -translate-x-1/2 text-white text-6xl opacity-10 select-none">
        Sky Tel Montage
      </div>

      {/* ScÃ©na s fyzikou */}
      <div ref={sceneRef} className="w-full h-full"></div>

      {/* OvlÃ¡dacÃ­ tlaÄÃ­tko */}
      <div className="absolute bottom-10 left-1/2 transform -translate-x-1/2">
        <button
          onClick={dropPiece}
          className="bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-4 rounded shadow-xl"
        >
          {fallen ? "Spadeno!" : "Odebrat kus stoÅ¾Ã¡ru"}
        </button>
      </div>

      {/* Vtipy dole */}
      <div className="absolute bottom-2 w-full text-center text-sm text-white opacity-80">
        <p>â€ProÄ technik nepadÃ¡? ProtoÅ¾e je pÅ™ivÃ¡zanej ke svÃ½ prÃ¡ci.â€œ</p>
        <p>â€BOZP: BuÄ OpatrnÃ½ ZvlÃ¡Å¡Å¥ Pod stoÅ¾Ã¡rem.â€œ</p>
      </div>
    </div>
  );
}

// ğŸ’¡ PoznÃ¡mka: pÅ™idat mÄ›nÃ­cÃ­ se pozadÃ­ (ÄasovaÄ mÄ›nÃ­ den/noc), vÃ­ce jazykÅ¯ a zvuky pozdÄ›ji.
