// All styles and HTML remain unchanged above this point

<script>
  const canvas = document.getElementById("matrix");
  const ctx = canvas.getContext("2d");
  canvas.height = window.innerHeight;
  canvas.width = window.innerWidth;
  const matrixChars = ["0", "1", "BudAA"];
  const fontSize = 16;
  const columns = canvas.width / fontSize;
  const drops = Array(Math.floor(columns)).fill(1);

  function drawMatrix() {
    ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#0f0";
    ctx.font = fontSize + "px Orbitron";
    drops.forEach((y, i) => {
      const char = matrixChars[Math.floor(Math.random() * matrixChars.length)];
      ctx.fillText(char, i * fontSize, y * fontSize);
      drops[i] = y * fontSize > canvas.height && Math.random() > 0.975 ? 0 : y + 1;
    });
  }
  setInterval(drawMatrix, 33);

  const music = document.getElementById('bg-music');
  const credit = document.getElementById('musicCredit');
  const tracks = [
    { src: 'bg.mp3', credit: '🎵 Music: "Free" by Play House (FMA) • CC BY 4.0' },
    { src: 'bg2.mp3', credit: '🎵 Track 2: "Cyber Haze" by GhostLoop (CC BY)' },
    { src: 'bg3.mp3', credit: '🎵 Track 3: "Digital Storm" by BitRunner (CC BY)' }
  ];
  let currentTrack = 0;

  document.addEventListener('click', () => {
    music.src = tracks[currentTrack].src;
    music.play().then(() => {
      credit.textContent = tracks[currentTrack].credit;
      credit.style.opacity = 1;
    });
  });

  credit.addEventListener('click', () => {
    currentTrack = (currentTrack + 1) % tracks.length;
    music.src = tracks[currentTrack].src;
    music.play();
    credit.textContent = tracks[currentTrack].credit;
  });

  const title = "SkyTelMontage.tech";
  const titleEl = document.getElementById("main-title");
  let typed = "";
  let index = 0;

  function animateTitle() {
    if (index < title.length) {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
      let spinCount = 0;
      const spinInterval = setInterval(() => {
        const randomChar = chars[Math.floor(Math.random() * chars.length)];
        titleEl.innerHTML = typed + randomChar;
        spinCount++;
        if (spinCount > 5) {
          clearInterval(spinInterval);
          typed += title[index];
          titleEl.innerHTML = typed;
          index++;
          setTimeout(animateTitle, 80);
        }
      }, 30);
    }
  }

  const jokes = {
    en: ["Why do programmers prefer dark mode? Because light attracts bugs.", "There are only 10 types of people: those who understand binary and those who don't."],
    cz: ["Proč programátoři milují tmu? Protože světlo přitahuje chyby.", "Existují jen 2 typy lidí: ti co chápou binárně a ti co ne."],
    de: ["Warum bevorzugen Programmierer Dunkelmodus? Weil Licht Bugs anzieht.", "Es gibt nur 10 Arten von Menschen: Die, die Binär verstehen, und die anderen."]
  };
  let currentJokeIndex = 0;

  function showJoke(lang = 'en') {
    const jokeEl = document.getElementById("joke");
    const jokeList = jokes[lang] || jokes['en'];
    jokeEl.textContent = "Loading intergalactic humour...";
    setTimeout(() => {
      jokeEl.textContent = jokeList[currentJokeIndex];
      currentJokeIndex = (currentJokeIndex + 1) % jokeList.length;
      setInterval(() => {
        jokeEl.textContent = jokeList[currentJokeIndex];
        currentJokeIndex = (currentJokeIndex + 1) % jokeList.length;
      }, 5000);
    }, 1500);
  }

  function setLang(lang) {
    document.documentElement.lang = lang === 'cz' ? 'cs' : lang;
    currentLang = lang;
    showJoke(lang);
  }

  let currentLang = 'en';

  document.getElementById('virusBox').addEventListener('click', () => {
    const isMobile = /Mobi|Android/i.test(navigator.userAgent);
    const msg = {
      en: "I just hacked into your PC!",
      cz: "Právě jsem se ti naboural do počítače!",
      de: "Ich habe mich gerade in deinen PC gehackt!"
    }[currentLang] || "I just hacked into your PC!";
    alert(isMobile ? msg.replace('PC', 'phone') : msg);
  });

  window.onload = () => {
    animateTitle();
    setLang(currentLang);
  };
</script>
